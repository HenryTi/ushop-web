(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{1752:function(a,b,c){a.exports=c(8027)},5982:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/user",function(){return c(220)}])},7441:function(a,b,c){"use strict";c.d(b,{W:function(){return u}});var d=c(7568),e=c(1438),f=c(4051),g=c.n(f),h=c(6042),i=c(1752),j=(0,i.default)().publicRuntimeConfig,k={get:function(a){return n.apply(this,arguments)},post:function(a,b){return o.apply(this,arguments)},put:function(a,b){return p.apply(this,arguments)},delete:function(a){return q.apply(this,arguments)}};function l(a,b){return m.apply(this,arguments)}function m(){return(m=(0,d.Z)(g().mark(function a(b,c){var d;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(b,c);case 2:return d=a.sent,a.next=5,s(d);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}},a)}))).apply(this,arguments)}function n(){return(n=(0,d.Z)(g().mark(function a(b){var c;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c={method:"GET",headers:r(b)},a.next=3,l(b,c);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a)}))).apply(this,arguments)}function o(){return(o=(0,d.Z)(g().mark(function a(b,c){var d;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d={method:"POST",headers:(0,h.Z)({"Content-Type":"application/json"},r(b)),credentials:"include",body:JSON.stringify(c)},a.next=3,l(b,d);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a)}))).apply(this,arguments)}function p(){return(p=(0,d.Z)(g().mark(function a(b,c){var d;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d={method:"PUT",headers:(0,h.Z)({"Content-Type":"application/json"},r(b)),body:JSON.stringify(c)},a.next=3,l(b,d);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a)}))).apply(this,arguments)}function q(){return(q=(0,d.Z)(g().mark(function a(b){var c;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c={method:"DELETE",headers:r(b)},a.next=3,l(b,c);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}},a)}))).apply(this,arguments)}function r(a){var b=u.user,c=b&&b.token,d=a.startsWith(j.apiUrl);return c&&d?{Authorization:"Bearer ".concat(b.token)}:{}}function s(a){return t.apply(this,arguments)}function t(){return(t=(0,d.Z)(g().mark(function a(b){var c,d,e;return g().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,b.text();case 2:if(d=(c=a.sent)&&JSON.parse(c),b.ok){a.next=8;break}return[401,403].includes(b.status)&&u.user&&u.logout(),e=d&&d.message||b.statusText,a.abrupt("return",Promise.reject(e));case 8:return a.abrupt("return",d);case 9:case"end":return a.stop()}},a)}))).apply(this,arguments)}var u=new(function(){function a(){(0,e.Z)(this,a)}var b=a.prototype;return b.load=function(){var a=localStorage.getItem("user");if(null===a?a=void 0:"object"==typeof a&&(a=void 0,localStorage.removeItem("user")),a){var b=localStorage.getItem("token");"string"!=typeof b&&(b=void 0),this.user={user:a,token:b},this.setCookie()}},b.setCookie=function(){if(void 0!==document){if(this.user){var a=this.user,b=(a.user,a.token);document.cookie="token=".concat(b,";path=/")}else document.cookie="token=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/"}},b.login=function(a,b){var c=this;return(0,d.Z)(g().mark(function d(){var e,f,h;return g().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,k.post("/api/auth/login",{username:a,password:b});case 2:return e=d.sent,c.user=e,f=e.name,h=e.token,f&&(c.setCookie(),localStorage.setItem("user",f),localStorage.setItem("token",h)),d.abrupt("return",c.user);case 7:case"end":return d.stop()}},d)}))()},b.logout=function(){var a=this;return(0,d.Z)(g().mark(function b(){return g().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:localStorage.removeItem("user"),a.user=void 0,a.setCookie();case 3:case"end":return b.stop()}},b)}))()},a}())},220:function(a,b,c){"use strict";c.r(b);var d=c(5893),e=c(7441),f=c(1163),g=c(7294);b.default=function(){var a=function(){e.W.logout(),i(null),b.back()},b=(0,f.useRouter)(),c=(0,g.useState)(void 0),h=c[0],i=c[1];if((0,g.useEffect)(function(){e.W.load(),i(e.W.user)},[]),null===h){b.push("/auth/login?backurl="+b.route);return}if(void 0!==h){var j=h.user;return(0,d.jsxs)("span",{children:[j,(0,d.jsx)("button",{onClick:a,children:"logout"})]})}}},1163:function(a,b,c){a.exports=c(387)},7568:function(a,b,c){"use strict";function d(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(j){c(j);return}h.done?b(i):Promise.resolve(i).then(d,e)}function e(a){return function(){var b=this,c=arguments;return new Promise(function(e,f){var g=a.apply(b,c);function h(a){d(g,e,f,h,i,"next",a)}function i(a){d(g,e,f,h,i,"throw",a)}h(void 0)})}}c.d(b,{Z:function(){return e}})},1438:function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}c.d(b,{Z:function(){return d}})}},function(a){a.O(0,[774,888,179],function(){var b;return a(a.s=5982)}),_N_E=a.O()}])